<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiPro | English Grammar Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Din+Round:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #ffffff;
            color: #4b4b4b;
            overflow-x: hidden;
        }

        .duo-card {
            border: 2px solid #e5e5e5;
            border-bottom: 4px solid #e5e5e5;
            transition: all 0.1s ease;
        }

        .duo-card:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        .duo-button-primary {
            background-color: #58cc02;
            border-bottom: 4px solid #46a302;
            color: white;
        }

        .duo-button-primary:hover { background-color: #61e002; }
        .duo-button-primary:active { border-bottom-width: 0; transform: translateY(4px); }

        .duo-button-secondary {
            background-color: #1cb0f6;
            border-bottom: 4px solid #1899d6;
            color: white;
        }

        .progress-bar-fill {
            transition: width 0.4s cubic-bezier(0.65, 0, 0.35, 1);
        }

        .option-btn {
            border: 2px solid #e5e5e5;
            border-bottom: 4px solid #e5e5e5;
            text-align: left;
            padding: 1rem;
            border-radius: 1rem;
            font-weight: 700;
            transition: all 0.1s;
        }

        .option-btn:hover { background-color: #f7f7f7; }
        .option-btn.selected {
            background-color: #ddf4ff;
            border-color: #84d8ff;
            color: #1899d6;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Top Navigation (Duolingo Style Stats) -->
    <nav class="sticky top-0 bg-white border-b-2 border-gray-100 z-30">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2 cursor-pointer" onclick="resetToHome()">
                    <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center text-white shadow-sm">
                        <i class="fas fa-feather-alt"></i>
                    </div>
                    <span class="text-xl font-extrabold text-green-500 tracking-tight hidden sm:block">lexipro</span>
                </div>
                
                <!-- Lesson Progress (Only visible during lesson) -->
                <div id="lessonProgressContainer" class="hidden flex-1 md:w-96 items-center gap-3">
                    <button onclick="confirmExit()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
                    <div class="flex-1 bg-gray-100 h-4 rounded-full overflow-hidden">
                        <div id="lessonBar" class="progress-bar-fill bg-green-500 h-full" style="width: 10%"></div>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-6 font-bold text-gray-500">
                <div class="flex items-center gap-2">
                    <span class="text-orange-500"><i class="fas fa-fire text-xl"></i></span>
                    <span id="statStreak">7</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-blue-400"><i class="fas fa-gem text-xl"></i></span>
                    <span id="statXP">1420</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-red-500"><i class="fas fa-heart text-xl"></i></span>
                    <span id="statHearts">5</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 max-w-5xl mx-auto w-full p-4 flex flex-col items-center">
        
        <!-- Home / Journey View -->
        <section id="viewHome" class="w-full py-8 space-y-12 flex flex-col items-center">
            <div class="text-center mb-4">
                <h2 class="text-2xl font-black text-gray-800 uppercase tracking-wide">Unit 1: Adverbs of Manner</h2>
                <p class="text-gray-500 font-bold">Learn to describe how things happen</p>
            </div>

            <!-- Path Nodes -->
            <div class="flex flex-col items-center gap-8 w-full max-w-xs">
                <div onclick="startLesson('basic')" class="relative cursor-pointer group">
                    <div class="w-20 h-20 bg-green-500 rounded-full border-b-8 border-green-700 flex items-center justify-center text-white text-3xl shadow-lg transform group-hover:scale-110 transition-transform">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="absolute -top-12 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-3 py-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap font-bold">START LEVEL 1</div>
                </div>

                <div class="w-2 h-12 bg-gray-200 rounded-full"></div>

                <div onclick="switchTab('accent')" class="relative cursor-pointer group">
                    <div class="w-20 h-20 bg-blue-400 rounded-full border-b-8 border-blue-600 flex items-center justify-center text-white text-3xl shadow-lg transform group-hover:scale-110 transition-transform">
                        <i class="fas fa-globe-americas"></i>
                    </div>
                    <div class="absolute -top-12 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-3 py-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap font-bold">ACCENT LAB</div>
                </div>

                <div class="w-2 h-12 bg-gray-200 rounded-full"></div>

                <div class="relative opacity-50 cursor-not-allowed">
                    <div class="w-20 h-20 bg-gray-300 rounded-full border-b-8 border-gray-400 flex items-center justify-center text-white text-3xl">
                        <i class="fas fa-lock"></i>
                    </div>
                    <span class="absolute -right-16 top-1/2 -translate-y-1/2 text-gray-400 font-black text-sm uppercase">Unit 2</span>
                </div>
            </div>
        </section>

        <!-- Lesson View -->
        <section id="viewLesson" class="hidden w-full max-w-xl py-12 flex-1 flex flex-col justify-between">
            <div id="lessonContent" class="space-y-8">
                <!-- Question injected here -->
            </div>

            <!-- Bottom Interaction Bar -->
            <div id="footerAction" class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-100 p-6 z-40">
                <div class="max-w-5xl mx-auto flex items-center justify-between">
                    <div id="feedbackText" class="hidden flex items-center gap-4">
                        <div id="feedbackIcon" class="w-12 h-12 rounded-full flex items-center justify-center text-2xl"></div>
                        <div>
                            <p id="feedbackTitle" class="font-black text-xl"></p>
                            <p id="feedbackSub" class="text-sm font-bold opacity-80"></p>
                        </div>
                    </div>
                    <div class="flex-1"></div>
                    <button id="btnCheck" onclick="checkSelection()" class="duo-button-primary px-12 py-3 rounded-2xl font-black text-lg uppercase tracking-wider disabled:opacity-50 disabled:bg-gray-200 disabled:border-gray-300 transition-all">Check</button>
                    <button id="btnContinue" onclick="nextStep()" class="hidden duo-button-primary px-12 py-3 rounded-2xl font-black text-lg uppercase tracking-wider transition-all">Continue</button>
                </div>
            </div>
        </section>

        <!-- Accent Lab View -->
        <section id="viewAccent" class="hidden w-full max-w-4xl py-8 space-y-8">
            <div class="flex items-center gap-4 mb-4">
                <button onclick="resetToHome()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-arrow-left text-xl"></i></button>
                <h2 class="text-3xl font-black text-gray-800">Accent Lab</h2>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-white duo-card p-6 rounded-3xl">
                        <h3 class="text-lg font-black mb-4 uppercase text-gray-400">Select Instructor Accent</h3>
                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="setAccent('en-US')" id="acc-us" class="p-4 rounded-2xl border-2 border-blue-500 bg-blue-50 text-blue-700 font-bold flex flex-col items-center gap-2">
                                <span class="text-2xl">ðŸ‡ºðŸ‡¸</span> US
                            </button>
                            <button onclick="setAccent('en-GB')" id="acc-uk" class="p-4 rounded-2xl border-2 border-gray-100 hover:border-blue-200 font-bold flex flex-col items-center gap-2">
                                <span class="text-2xl">ðŸ‡¬ðŸ‡§</span> UK
                            </button>
                            <button onclick="setAccent('en-CA')" id="acc-ca" class="p-4 rounded-2xl border-2 border-gray-100 hover:border-blue-200 font-bold flex flex-col items-center gap-2">
                                <span class="text-2xl">ðŸ‡¨ðŸ‡¦</span> Canada
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white duo-card p-6 rounded-3xl">
                         <h3 class="text-lg font-black mb-2 uppercase text-gray-400">Try it out</h3>
                         <textarea id="labText" class="w-full bg-gray-50 p-4 rounded-2xl font-bold text-gray-700 outline-none h-32" placeholder="Type a sentence here..."></textarea>
                         <button onclick="generateAudio()" class="mt-4 w-full duo-button-secondary py-4 rounded-2xl font-black uppercase">Hear in Accent</button>
                    </div>
                </div>

                <div class="bg-blue-600 rounded-[2.5rem] p-10 text-white flex flex-col justify-center items-center text-center">
                    <i class="fas fa-microphone-alt text-6xl mb-6"></i>
                    <h3 class="text-2xl font-black mb-4">Pronunciation Coach</h3>
                    <p class="font-bold opacity-80 mb-8">Speak any adverb into the mic and our coach will evaluate your natural rhythm.</p>
                    <button onclick="startMicCheck('fluently')" class="bg-white text-blue-600 px-10 py-4 rounded-2xl font-black uppercase shadow-xl hover:scale-105 transition-all">Start Speaking</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Game State ---
        let xp = 1420;
        let hearts = 5;
        let streak = 7;
        let currentLessonData = [];
        let lessonIndex = 0;
        let selectedOption = null;
        let currentLevel = 'basic';
        let voices = [];
        let activeAccent = 'en-US';

        const db = {
            basic: [
                { type: 'mcq', prompt: 'Select the correct adverb:', sentence: 'The snail moves _______ through the garden.', options: ['slowly', 'happy', 'quick'], correct: 'slowly', audio: 'The snail moves slowly through the garden.' },
                { type: 'speak', prompt: 'Repeat this word:', target: 'Quickly', audio: 'Quickly' },
                { type: 'translate', prompt: 'Tap the matching pair:', pairs: { 'Slowly': 'Lentamente', 'Happily': 'Felizmente', 'Quickly': 'RÃ¡pidamente' } },
                { type: 'listen', prompt: 'What do you hear?', audio: 'She sang beautifully at the concert.', options: ['beautifully', 'beautify', 'beauty'], correct: 'beautifully' }
            ]
        };

        // --- View Navigation ---

        function startLesson(level) {
            currentLevel = level;
            currentLessonData = db[level];
            lessonIndex = 0;
            hearts = 5;
            
            document.getElementById('viewHome').classList.add('hidden');
            document.getElementById('viewLesson').classList.remove('hidden');
            document.getElementById('lessonProgressContainer').classList.remove('hidden');
            renderLessonStep();
        }

        function resetToHome() {
            document.getElementById('viewHome').classList.remove('hidden');
            document.getElementById('viewLesson').classList.add('hidden');
            document.getElementById('viewAccent').classList.add('hidden');
            document.getElementById('lessonProgressContainer').classList.add('hidden');
        }

        function switchTab(tab) {
            document.getElementById('viewHome').classList.add('hidden');
            document.getElementById('viewAccent').classList.remove('hidden');
        }

        function renderLessonStep() {
            const step = currentLessonData[lessonIndex];
            const content = document.getElementById('lessonContent');
            const progress = ((lessonIndex) / currentLessonData.length) * 100;
            document.getElementById('lessonBar').style.width = `${progress}%`;

            // Reset footer
            document.getElementById('btnCheck').classList.remove('hidden');
            document.getElementById('btnCheck').disabled = true;
            document.getElementById('btnContinue').classList.add('hidden');
            document.getElementById('feedbackText').classList.add('hidden');
            document.getElementById('footerAction').className = "fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-100 p-6 z-40 transition-colors duration-300";

            selectedOption = null;

            if (step.type === 'mcq') {
                content.innerHTML = `
                    <h2 class="text-2xl font-black mb-8">${step.prompt}</h2>
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600 text-2xl cursor-pointer hover:bg-blue-200 transition-colors" onclick="speakText('${step.audio}')">
                            <i class="fas fa-volume-up"></i>
                        </div>
                        <p class="text-xl font-bold border-2 border-gray-100 p-4 rounded-2xl bg-gray-50">${step.sentence.replace('_______', '<span class="text-blue-500 underline">_______</span>')}</p>
                    </div>
                    <div class="grid gap-4">
                        ${step.options.map(opt => `
                            <button onclick="selectOption(this, '${opt}')" class="option-btn">${opt}</button>
                        `).join('')}
                    </div>
                `;
            } else if (step.type === 'speak') {
                content.innerHTML = `
                    <h2 class="text-2xl font-black mb-8">${step.prompt}</h2>
                    <div class="flex flex-col items-center gap-6 py-10">
                        <div class="w-32 h-32 bg-blue-500 text-white rounded-full flex items-center justify-center text-4xl shadow-xl cursor-pointer hover:scale-110 transition-all" onclick="speakText('${step.audio}')">
                            <i class="fas fa-volume-up"></i>
                        </div>
                        <h1 class="text-4xl font-black text-gray-800 tracking-tight">${step.target}</h1>
                        <button onclick="startMicCheck('${step.target}')" id="micBtn" class="mt-8 duo-button-secondary px-8 py-4 rounded-2xl font-black uppercase flex items-center gap-3">
                            <i class="fas fa-microphone"></i> Tap to speak
                        </button>
                    </div>
                `;
                // Speaker steps don't need "Check", they trigger on result
                document.getElementById('btnCheck').classList.add('hidden');
            } else if (step.type === 'listen') {
                content.innerHTML = `
                    <h2 class="text-2xl font-black mb-8">${step.prompt}</h2>
                    <div class="flex justify-center mb-10">
                         <button onclick="speakText('${step.audio}')" class="w-40 h-40 bg-blue-500 rounded-3xl border-b-8 border-blue-700 text-white flex items-center justify-center text-6xl shadow-xl active:translate-y-2 active:border-b-0 transition-all">
                            <i class="fas fa-volume-up"></i>
                         </button>
                    </div>
                    <div class="grid gap-3">
                        ${step.options.map(opt => `<button onclick="selectOption(this, '${opt}')" class="option-btn">${opt}</button>`).join('')}
                    </div>
                `;
            }
        }

        // --- Interaction Logic ---

        function selectOption(btn, val) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedOption = val;
            document.getElementById('btnCheck').disabled = false;
        }

        function checkSelection() {
            const step = currentLessonData[lessonIndex];
            const isCorrect = selectedOption === step.correct;
            handleFeedback(isCorrect);
        }

        function handleFeedback(isCorrect) {
            const footer = document.getElementById('footerAction');
            const feedback = document.getElementById('feedbackText');
            const btnCheck = document.getElementById('btnCheck');
            const btnContinue = document.getElementById('btnContinue');

            feedback.classList.remove('hidden');
            btnCheck.classList.add('hidden');
            btnContinue.classList.remove('hidden');

            if (isCorrect) {
                footer.classList.replace('bg-white', 'bg-green-100');
                document.getElementById('feedbackIcon').className = "w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-white text-green-500";
                document.getElementById('feedbackIcon').innerHTML = '<i class="fas fa-check"></i>';
                document.getElementById('feedbackTitle').innerText = "You are correct!";
                document.getElementById('feedbackTitle').className = "font-black text-xl text-green-700";
                xp += 10;
                document.getElementById('statXP').innerText = xp;
            } else {
                footer.classList.replace('bg-white', 'bg-red-100');
                document.getElementById('feedbackIcon').className = "w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-white text-red-500";
                document.getElementById('feedbackIcon').innerHTML = '<i class="fas fa-times"></i>';
                document.getElementById('feedbackTitle').innerText = "Wrong answer!";
                document.getElementById('feedbackTitle').className = "font-black text-xl text-red-700";
                document.getElementById('feedbackSub').innerText = `The correct answer was: ${currentLessonData[lessonIndex].correct}`;
                hearts--;
                document.getElementById('statHearts').innerText = hearts;
                document.body.classList.add('shake');
                setTimeout(() => document.body.classList.remove('shake'), 500);
            }
        }

        function nextStep() {
            lessonIndex++;
            if (lessonIndex < currentLessonData.length && hearts > 0) {
                renderLessonStep();
            } else {
                completeLesson();
            }
        }

        function completeLesson() {
            alert(`Lesson Complete! +50 XP earned.`);
            document.getElementById('lessonBar').style.width = `100%`;
            resetToHome();
        }

        // --- Audio & Voices ---

        function populateVoices() {
            voices = window.speechSynthesis.getVoices();
        }

        function speakText(text) {
            const utter = new SpeechSynthesisUtterance(text);
            const voice = voices.find(v => v.lang.startsWith(activeAccent.split('-')[0]));
            if (voice) utter.voice = voice;
            utter.rate = 0.9;
            window.speechSynthesis.speak(utter);
        }

        function setAccent(lang) {
            activeAccent = lang;
            ['acc-us', 'acc-uk', 'acc-ca'].forEach(id => {
                document.getElementById(id).className = "p-4 rounded-2xl border-2 border-gray-100 font-bold flex flex-col items-center gap-2";
            });
            const activeId = lang === 'en-US' ? 'acc-us' : lang === 'en-GB' ? 'acc-uk' : 'acc-ca';
            document.getElementById(activeId).className = "p-4 rounded-2xl border-2 border-blue-500 bg-blue-50 text-blue-700 font-bold flex flex-col items-center gap-2";
        }

        function generateAudio() {
            const val = document.getElementById('labText').value;
            if(val) speakText(val);
        }

        function startMicCheck(target) {
            if (!('webkitSpeechRecognition' in window)) return alert("Speech recognition not supported.");
            const recognition = new webkitSpeechRecognition();
            recognition.lang = activeAccent;
            
            const btn = document.getElementById('micBtn');
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Listening...';
            
            recognition.onresult = (e) => {
                const result = e.results[0][0].transcript.toLowerCase();
                if(result.includes(target.toLowerCase())) {
                    handleFeedback(true);
                    document.getElementById('feedbackTitle').innerText = "Perfect Pronunciation!";
                } else {
                    handleFeedback(false);
                    document.getElementById('feedbackSub').innerText = `We heard "${result}". Try again!`;
                }
                btn.innerHTML = '<i class="fas fa-microphone"></i> Tap to speak';
            };
            recognition.start();
        }

        window.onload = () => {
            window.speechSynthesis.onvoiceschanged = populateVoices;
            populateVoices();
        };

    </script>
</body>
</html>